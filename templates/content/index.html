{% extends 'base.html' %}
{% load static %}

{% block title %}НекстАналитика — сервис аналитики для маркетплейсов{% endblock %}

{% block meta_description %}Единая панель для контроля бизнеса на маркетплейсах. Понимайте спрос, маржинальность и риски в реальном времени. Получайте подсказки по ассортименту, рекламе и логистике в одном интерфейсе.{% endblock %}

{% block content %}
<div class="hero-wrapper">
  <section class="section hero">
    <div class="hero__content">
      <h1 class="hero__title">Единая панель для контроля бизнеса на маркетплейсах</h1>
      <p class="hero__subtitle">Понимайте спрос, маржинальность и риски в реальном времени. Получайте подсказки по ассортименту, рекламе и логистике в одном интерфейсе.</p>
      <div class="hero__actions">
        <button class="button button--primary" data-scroll-target="#configurator">Собрать решение</button>
      </div>
    </div>
    <div class="hero__visual">
      <img src="{% static 'assets/images/hero_img.png' %}" alt="НекстАналитика — аналитика для продавцов маркетплейсов" class="hero__image">
    </div>
  </section>
</div>

<section class="section configurator" id="configurator">
  <div class="section-heading">
    <h2 class="section-heading__title">Соберите доступ к нужным дашбордам</h2>
    <p class="section-heading__description">Выберите маркетплейсы, количество кабинетов и срок подписки — система автоматически рассчитает стоимость.</p>
  </div>
  <div class="configurator__grid">
    <div class="configurator__list" id="dashboardList" aria-live="polite"></div>
    <aside class="configurator__summary">
      <div class="summary-card">
        <h3 class="summary-card__title">Текущая конфигурация</h3>
        <p class="summary-card__value" data-live-price>0 ₽</p>
        <p class="summary-card__info">Стоимость появится после добавления дашбордов в корзину.</p>
        <div class="summary-card__cart">
          <h4>Корзина</h4>
          <ul class="summary-card__list" data-mini-cart></ul>
          <a class="button button--primary button--block" href="{% url 'cart:cart' %}">Перейти в корзину</a>
          <a class="summary-card__clear" href="#" data-clear-cart style="display: none;">Очистить</a>
        </div>
      </div>
    </aside>
  </div>
</section>

{% if personas %}
<section class="section personas">
  <div class="section-heading">
    <h2 class="section-heading__title">Чем мы помогаем разным типам продавцов</h2>
  </div>
  <div class="personas__grid">
    {% for persona in personas %}
    <article class="persona-card">
      {% if persona.icon_svg %}
      <div class="persona-card__icon" aria-hidden="true">
        {{ persona.icon_svg|safe }}
      </div>
      {% endif %}
      <h3 class="persona-card__title">{{ persona.title }}</h3>
      <p class="persona-card__description">{{ persona.description }}</p>
    </article>
    {% endfor %}
  </div>
</section>
{% endif %}

{% if scheme_flows %}
<section class="section scheme">
  <div class="section-heading">
    <h2 class="section-heading__title">Общая схема взаимодействия</h2>
  </div>
  <ol class="scheme-flow" role="list">
    {% for flow in scheme_flows %}
    <li class="scheme-flow__item">
      <span class="scheme-flow__marker" aria-hidden="true">{{ flow.step_number }}</span>
      <div class="scheme-flow__body">
        <span class="scheme-flow__tag">{{ flow.tag }}</span>
        <p class="scheme-flow__title">{{ flow.title }}</p>
        <p class="scheme-flow__text">{{ flow.description }}</p>
      </div>
    </li>
    {% endfor %}
  </ol>
</section>
{% endif %}

{% if process_steps %}
<section class="section process">
  <div class="section-heading">
    <h2 class="section-heading__title">Как начать работу</h2>
  </div>
  <p class="process__lead">Готовая дорожная карта с понятными шагами и ожиданиями по времени — без сюрпризов для вашей команды.</p>
  <div class="process__grid">
    {% for step in process_steps %}
    <article class="process-card">
      <div class="process-card__head">
        <span class="process-card__step">Шаг {{ step.step_number }}</span>
        <span class="process-card__tag">{{ step.time_tag }}</span>
      </div>
      <h3 class="process-card__title">{{ step.title }}</h3>
      <p class="process-card__text">{{ step.description }}</p>
      {% if step.items %}
      <ul class="process-card__list">
        {% for item in step.items %}
        <li>{{ item }}</li>
        {% endfor %}
      </ul>
      {% endif %}
    </article>
    {% endfor %}
  </div>
</section>
{% endif %}

{% if metrics %}
<section class="section social-proof" aria-label="Ключевые показатели">
  <div class="social-proof__metrics" role="list">
    {% for metric in metrics %}
    <div class="social-proof__metric" role="listitem">
      <span class="social-proof__metric-label">{{ metric.label }}</span>
      <span class="social-proof__metric-value">{{ metric.value|safe }}</span>
      <span class="social-proof__metric-desc">{{ metric.description }}</span>
    </div>
    {% endfor %}
  </div>
</section>
{% endif %}

{% if benefits %}
<section class="section benefits">
  <div class="section-heading">
    <h2 class="section-heading__title">Почему нас выбирают</h2>
  </div>
  <div class="benefits__grid">
    {% for benefit in benefits %}
    <article class="benefit-card">
      {% if benefit.icon_image %}
      <div class="benefit-card__icon" aria-hidden="true">
        <img src="{{ benefit.icon_image.url }}" alt="{{ benefit.title }}" />
      </div>
      {% endif %}
      <h3 class="benefit-card__title">{{ benefit.title }}</h3>
      <p class="benefit-card__description">{{ benefit.description }}</p>
    </article>
    {% endfor %}
  </div>
</section>
{% endif %}

{% if faqs %}
<section class="section faq" id="faq">
  <div class="section-heading">
    <h2 class="section-heading__title">Частые вопросы</h2>
  </div>
  <div class="faq__container">
    <div class="faq__list">
      {% for faq in faqs %}
      <details class="faq-item" {% if faq.is_expanded %}open{% endif %}>
        <summary class="faq-item__header">
          <span class="faq-item__question">{{ faq.question }}</span>
          <span class="faq-item__toggle" aria-hidden="true">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
        </summary>
        <div class="faq-item__content">
          <p>{{ faq.answer }}</p>
        </div>
      </details>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
  // API endpoints для работы с дашбордами и корзиной
  window.DASHBOARDS_API_URL = '{% url "dashboards:api_dashboard_list" %}';
  window.PRICE_CALCULATE_API_URL = '{% url "dashboards:api_price_calculate" %}';
  window.CART_API_URL = '{% url "cart:api_cart" %}';
  window.CART_TOTAL_API_URL = '{% url "cart:api_cart_total" %}';
</script>
{% endblock %}

